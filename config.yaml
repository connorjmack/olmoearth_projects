# lightning.pytorch==2.5.1.post0
seed_everything: 0
trainer:
  accelerator: auto
  strategy: auto
  devices: auto
  num_nodes: 1
  precision: null
  logger: false
  callbacks:
  - class_path: lightning.pytorch.callbacks.LearningRateMonitor
    init_args:
      logging_interval: epoch
      log_momentum: false
      log_weight_decay: false
  - class_path: lightning.pytorch.callbacks.ModelCheckpoint
    init_args:
      dirpath: conus_solar_tracking/scratch/test/model_stage_0/trainer_checkpoints
      filename: null
      monitor: val_class/accuracy
      verbose: false
      save_last: true
      save_top_k: 1
      save_weights_only: false
      mode: max
      auto_insert_metric_name: true
      every_n_train_steps: null
      train_time_interval: null
      every_n_epochs: null
      save_on_train_epoch_end: null
      enable_version_counter: true
  - class_path: rslearn.train.callbacks.freeze_unfreeze.FreezeUnfreeze
    init_args:
      module_selector:
      - model
      - encoder
      - 0
      unfreeze_at_epoch: 20
      unfreeze_lr_factor: 10.0
  - class_path: rslearn.train.prediction_writer.RslearnWriter
    init_args:
      path: conus_solar_tracking/scratch/test/dataset_0
      output_layer: output
      path_options: null
      selector:
      - class
      merger: null
      output_path: null
      layer_config: null
  fast_dev_run: false
  max_epochs: 500
  min_epochs: null
  max_steps: -1
  min_steps: null
  max_time: null
  limit_train_batches: null
  limit_val_batches: null
  limit_test_batches: null
  limit_predict_batches: null
  overfit_batches: 0.0
  val_check_interval: null
  check_val_every_n_epoch: 1
  num_sanity_val_steps: null
  log_every_n_steps: null
  enable_checkpointing: null
  enable_progress_bar: null
  enable_model_summary: null
  accumulate_grad_batches: 1
  gradient_clip_val: null
  gradient_clip_algorithm: null
  deterministic: null
  benchmark: null
  inference_mode: true
  use_distributed_sampler: false
  profiler: null
  detect_anomaly: false
  barebones: false
  plugins: null
  sync_batchnorm: false
  reload_dataloaders_every_n_epochs: 0
  default_root_dir: null
  model_registry: null
model:
  class_path: conus_solar_tracking.custom_lightning_module.NonStrictRslearnLightningModule
  init_args:
    model:
      class_path: rslearn.models.multitask.MultiTaskModel
      init_args:
        encoder:
        - class_path: rslearn.models.olmoearth_pretrain.model.OlmoEarth
          init_args:
            patch_size: 8
            model_id: OLMOEARTH_V1_BASE
            model_path: null
            checkpoint_path: null
            selector:
            - encoder
            forward_kwargs: {}
            random_initialization: false
            embedding_size: null
            autocast_dtype: bfloat16
        decoders:
          class:
          - class_path: rslearn.models.unet.UNetDecoder
            init_args:
              in_channels:
              - - 8
                - 768
              out_channels: 2
              conv_layers_per_resolution: 2
              kernel_size: 3
              num_channels:
                '8': 512
                '4': 512
                '2': 256
                '1': 128
              target_resolution_factor: 1
              original_size_to_interpolate: null
          - class_path: rslearn.train.tasks.segmentation.SegmentationHead
        lazy_decode: false
        loss_weights: null
        trunk: null
    optimizer: null
    scheduler:
      class_path: rslearn.train.scheduler.PlateauScheduler
      init_args:
        mode: null
        factor: 0.2
        patience: 2
        threshold: null
        threshold_mode: null
        cooldown: 20
        min_lr: 0.0
        eps: null
    visualize_dir: null
    metrics_file: null
    restore_config: null
    print_parameters: false
    print_model: false
    lr: 0.0001
    plateau: false
    plateau_factor: 0.1
    plateau_patience: 10
    plateau_min_lr: 0.0
    plateau_cooldown: 0
data:
  class_path: rslearn.train.data_module.RslearnDataModule
  init_args:
    inputs:
      mask:
        class_path: rslearn.train.dataset.DataInput
        init_args:
          data_type: raster
          layers:
          - mask
          bands:
          - mask
          required: true
          passthrough: true
          is_target: true
          dtype: FLOAT32
          load_all_layers: false
          load_all_item_groups: false
      sentinel2_l2a:
        class_path: rslearn.train.dataset.DataInput
        init_args:
          data_type: raster
          layers:
          - sentinel2
          - sentinel2.1
          - sentinel2.2
          bands:
          - B02
          - B03
          - B04
          - B08
          - B05
          - B06
          - B07
          - B8A
          - B11
          - B12
          - B01
          - B09
          required: true
          passthrough: true
          is_target: false
          dtype: FLOAT32
          load_all_layers: true
          load_all_item_groups: false
      targets:
        class_path: rslearn.train.dataset.DataInput
        init_args:
          data_type: raster
          layers:
          - label_raster
          bands:
          - label
          required: true
          passthrough: false
          is_target: true
          dtype: INT32
          load_all_layers: false
          load_all_item_groups: false
    task:
      class_path: rslearn.train.tasks.multi_task.MultiTask
      init_args:
        tasks:
          class:
            class_path: rslearn.train.tasks.segmentation.SegmentationTask
            init_args:
              num_classes: 2
              class_id_mapping: null
              colors:
              - - 255
                - 0
                - 0
              - - 0
                - 255
                - 0
              - - 0
                - 0
                - 255
              - - 255
                - 255
                - 0
              - - 0
                - 255
                - 255
              - - 255
                - 0
                - 255
              - - 0
                - 128
                - 0
              - - 255
                - 160
                - 122
              - - 139
                - 69
                - 19
              - - 128
                - 128
                - 128
              - - 255
                - 255
                - 255
              - - 143
                - 188
                - 143
              - - 95
                - 158
                - 160
              - - 255
                - 200
                - 0
              - - 128
                - 0
                - 0
              zero_is_invalid: false
              nodata_value: null
              enable_accuracy_metric: true
              enable_miou_metric: false
              enable_f1_metric: true
              f1_metric_thresholds:
              - - 0.05
                - 0.1
                - 0.2
                - 0.3
                - 0.4
                - 0.5
                - 0.6
                - 0.7
                - 0.8
                - 0.9
              - - 0.1
              - - 0.2
              - - 0.3
              - - 0.4
              - - 0.5
              - - 0.6
              - - 0.7
              - - 0.8
              - - 0.9
              metric_kwargs:
                average: micro
              miou_metric_kwargs: {}
              prob_scales: null
              other_metrics: {}
              image_bands:
              - 0
              - 1
              - 2
              remap_values:
              - - 0.0
                - 1.0
              - - 0
                - 255
        input_mapping:
          class:
            targets: targets
    path: conus_solar_tracking/scratch/test/dataset_0
    path_options: {}
    batch_size: 8
    num_workers: 14
    init_workers: 0
    default_config:
      class_path: rslearn.train.dataset.SplitConfig
      init_args:
        groups: null
        names: null
        tags: null
        num_samples: null
        num_patches: null
        transforms:
        - class_path: rslearn.models.olmoearth_pretrain.norm.OlmoEarthNormalize
          init_args:
            band_names:
              sentinel2_l2a:
              - B02
              - B03
              - B04
              - B08
              - B05
              - B06
              - B07
              - B8A
              - B11
              - B12
              - B01
              - B09
            std_multiplier: 2.0
            config_fname: null
        - class_path: rslearn.train.transforms.mask.Mask
          init_args:
            selectors:
            - sentinel2_l2a
            mask_selector: mask
            mask_value: 0
        sampler: null
        patch_size: null
        overlap_ratio: null
        load_all_patches: null
        skip_targets: null
    train_config:
      class_path: rslearn.train.dataset.SplitConfig
      init_args:
        groups: null
        names: null
        tags:
          split: train
        num_samples: null
        num_patches: null
        transforms:
        - class_path: rslearn.models.olmoearth_pretrain.norm.OlmoEarthNormalize
          init_args:
            band_names:
              sentinel2_l2a:
              - B02
              - B03
              - B04
              - B08
              - B05
              - B06
              - B07
              - B8A
              - B11
              - B12
              - B01
              - B09
            std_multiplier: 2.0
            config_fname: null
        - class_path: rslearn.train.transforms.mask.Mask
          init_args:
            selectors:
            - sentinel2_l2a
            mask_selector: mask
            mask_value: 0
        - class_path: rslearn.train.transforms.flip.Flip
          init_args:
            horizontal: true
            vertical: true
            image_selectors:
            - sentinel2_l2a
            - target/class/classes
            - target/class/valid
            box_selectors: []
        sampler:
          class_path: rslearn.train.dataset.RandomSamplerFactory
          init_args:
            replacement: true
            num_samples: 16384
        patch_size: 128
        overlap_ratio: null
        load_all_patches: null
        skip_targets: null
    val_config:
      class_path: rslearn.train.dataset.SplitConfig
      init_args:
        groups: null
        names: null
        tags:
          split: val
        num_samples: null
        num_patches: null
        transforms: null
        sampler: null
        patch_size: 128
        overlap_ratio: null
        load_all_patches: true
        skip_targets: null
    test_config:
      class_path: rslearn.train.dataset.SplitConfig
      init_args:
        groups: null
        names: null
        tags:
          split: val
        num_samples: null
        num_patches: null
        transforms: null
        sampler: null
        patch_size: 128
        overlap_ratio: null
        load_all_patches: true
        skip_targets: null
    predict_config:
      class_path: rslearn.train.dataset.SplitConfig
      init_args:
        groups:
        - group_partition_1
        names: null
        tags: null
        num_samples: null
        num_patches: null
        transforms:
        - class_path: rslearn.models.olmoearth_pretrain.norm.OlmoEarthNormalize
          init_args:
            band_names:
              sentinel2_l2a:
              - B02
              - B03
              - B04
              - B08
              - B05
              - B06
              - B07
              - B8A
              - B11
              - B12
              - B01
              - B09
            std_multiplier: 2.0
            config_fname: null
        sampler: null
        patch_size: 128
        overlap_ratio: null
        load_all_patches: true
        skip_targets: true
    name: null
    retries: 0
    use_in_memory_all_patches_dataset: false
management_dir: null
project_name: null
run_name: null
run_description: ''
load_checkpoint_mode: auto
load_checkpoint_required: auto
log_mode: auto
optimizer: null
lr_scheduler: null
return_predictions: false
ckpt_path: conus_solar_tracking/scratch/test/model_stage_0/checkpoint.ckpt
